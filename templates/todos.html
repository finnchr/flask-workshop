<!DOCTYPE html><html lang="en">	<head>		<meta name="viewport" content="width=device-width, initial-scale=1">		<!-- Latest compiled and minified CSS -->		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">		<!-- Optional theme -->		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>		<script src="//cdnjs.cloudflare.com/ajax/libs/knockout/3.1.0/knockout-min.js"></script>		<style>			form.newTodoForm input {				margin-top: 5px;				margin-bottom: 5px;				border: 1px solid #eee;				padding: 7px 7px 7px 7px;				width: 300px;			}			form.newTodoForm button {				width: 50px;			}			input[type=checkbox] {				margin-left: 0;				width: 15px;				display: inline;			}			.edit-todo * {				display: inline;			}			.edit-todo input[type=text] {				margin-top: 5px;				margin-bottom: 5px;				border: 1px solid #eee;				padding: 7px 7px 7px 7px;				width: 300px;			}			.edit-todo select {				margin-top: 5px;				margin-bottom: 5px;				border: 1px solid #eee;				padding: 7px 7px 7px 7px;				width: 100px;			}			.todo {				display:inline-block;				width: 300px;				padding: 7px 7px 7px 7px;				margin-top: 5px;				margin-bottom: 5px;			}			.todo .glyphicon {				display:none;			}			.todo:hover {				border: 1px solid #eee;				padding: 6px 6px 6px 6px;			}			.todo:hover .glyphicon {				display:inline;			}			.completed span { text-decoration: line-through; }			.completed .glyphicon { text-decoration: none; }		</style>	</head>	<body>		<nav class="navbar navbar-default" role="navigation">			<div class="container-fluid">				<div class="navbar-header">					<span class="navbar-brand">{{ title }}</span>				</div>				<!-- Collect the nav links, forms, and other content for toggling -->				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">				<ul class="nav navbar-nav pull-right">				</ul>			</div>		</nav>		<div class="container-fluid">			<div class="row">				<div class="col-md-12">					<p>						<form class="newTodoForm" role="form">							<input data-bind="value: newTodoText" type="text" />							<!-- <button data-bind="click: addTodo" type="button" class="form-control btn btn-primary">Add</button> -->							<a href="#" data-bind="click: addTodo"><span class="glyphicon glyphicon-plus"></span></a>						</form>					</p>					<div data-bind="foreach: todos">						<div data-bind="if: !completed()">							<!-- ko if: edit -->							<div class="edit-todo">								<input data-bind="value: text" type="text" autofocus />								<select data-bind="value: priority">									<option value="1">High</option>									<option value="0">Normal</option>									<option value="-1">Low</option>								</select>								<a href="#" data-bind="click: endEdit"><span class="glyphicon glyphicon-floppy-disk"></span></a>							</div>							<!-- /ko -->							<!-- ko ifnot: edit -->							<div class="todo">								<input data-bind="checked: completed" type="checkbox" />								<span data-bind="text: text"></span>								<span data-bind="visible: highPriority" class="label label-danger">High</span>								<!-- <span data-bind="visible: normalPriority" class="label label-default">Normal</span> -->								<span data-bind="visible: lowPriority" class="label label-warning">Low</span>								<a href="#" data-bind="click: startEdit" class="pull-right"><span class="glyphicon glyphicon-pencil"></span></a>							</div>							<!-- /ko -->						</div>					</div>				</div>			</div>			<hr />			<div class="row">				<div class="col-md-12">					<div data-bind="foreach: todos">						<div data-bind="if: completed()">							<div class="todo completed">								<input data-bind="checked: completed" type="checkbox" />								<span data-bind="text: text"></span>								<a href="#" data-bind="click: deleteTodo" class="pull-right"><span class="glyphicon glyphicon-trash"></span></a>							</div>						</div>					</div>				</div>			</div>		</div>		<script>			function TodoViewModel(id, text, completed, priority, removeTodo) {				var self = this;				self.id = id;				self.text = ko.observable(text);				self.completed = ko.observable(completed);				self.priority = ko.observable(priority);				self.edit = ko.observable(false);				var changes = {};				var ajaxDefaults = {					url: 'http://localhost:5000/api/todos/' + self.id,					contentType: 'application/json; charset=utf-8;',					dataType: 'json',					processData: false,					error: function(jqXhr, textStatus, errorThrown) {						console.log('error');					}				};				self.highPriority = ko.computed(function() {					return self.priority() == 1;				});				self.normalPriority = ko.computed(function() {					return self.priority() == 0;				});				self.lowPriority = ko.computed(function() {					return self.priority() == -1;				});				ko.computed(function() {					var text = self.text();					if(ko.computedContext.isInitial()) {						return;					}					changes['text'] = text;				});				ko.computed(function() {					var completed = self.completed();					if(ko.computedContext.isInitial()) {						return;					}					changes['completed'] = completed;					self.saveTodo();				});				ko.computed(function() {					var priority = self.priority();					if(ko.computedContext.isInitial()) {						return;					}					changes['priority'] = priority;				});				self.startEdit = function() {					self.edit(true);				};				self.endEdit = function() {					self.edit(false);					self.saveTodo();				};				self.saveTodo = function() {					$.ajax($.extend(ajaxDefaults, {						type: "PUT",						data: JSON.stringify(changes)					})).then(function(todo) {						self.edit(false);						console.log('Changes saved', changes);						changes = {}; // clear changes					}).fail(function(a,b,c) {						console.log('Failed',a,b,c);					});				};				self.deleteTodo = function() {					$.ajax($.extend(ajaxDefaults, {						dataType: '',						type: "DELETE"					})).then(function() {						console.log('Deleted: ' + self.text());						removeTodo(self);					});				};			}			function AppViewModel() {				var self = this;				self.todos = ko.observableArray();				self.newTodoText = ko.observable();				$.getJSON('http://localhost:5000/api/todos').then(function(todos) {					$.each(todos, function(index, todo) {						self.todos.push(new TodoViewModel(todo.id, todo.text, todo.completed, todo.priority, self.removeTodo));					});				});				self.removeTodo = function(todo) {					self.todos.remove(todo);				};				self.addTodo = function() {					var r = $.ajax({						type: "POST",						url: 'http://localhost:5000/api/todos',						contentType: 'application/json; charset=utf-8;',						dataType: 'json',						processData: false,						data: ko.toJSON({ text: self.newTodoText }),						success: function(todo) {							self.todos.push(new TodoViewModel(todo.id, todo.text, todo.completed, self.priority, self.removeTodo));							self.newTodoText('');						},						error: function(jqXhr, textStatus, errorThrown) {							console.log('error');						}					});				};			}			$(function() {				var appViewModel = new AppViewModel();				ko.applyBindings(appViewModel);			});		</script	</body></html>